generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  username  String   @unique
  password  String
  balance   Float    @default(0)
  deviceId  String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  sentTransactions     Transaction[] @relation("SenderTransactions")
  receivedTransactions Transaction[] @relation("ReceiverTransactions")
  fraudAlerts          FraudAlert[]
  userSessions         UserSession[]

  @@map("users")
}

model Transaction {
  id          Int      @id @default(autoincrement())
  senderId    Int
  receiverId  Int
  amount      Float
  type        String   @default("transfer")
  status      String   @default("completed") // completed, pending, failed
  description String?
  deviceId    String?
  ipAddress   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  sender   User @relation("SenderTransactions", fields: [senderId], references: [id])
  receiver User @relation("ReceiverTransactions", fields: [receiverId], references: [id])

  // Fraud Detection
  fraudRiskScore Float?
  fraudRiskLevel String? // LOW, MEDIUM, HIGH, CRITICAL
  fraudReasons   String? // JSON array of reasons

  @@map("transactions")
  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
}

model FraudAlert {
  id             Int      @id @default(autoincrement())
  userId         Int?
  transactionId  Int?
  deviceId       String
  deviceName     String?
  riskScore      Float
  riskLevel      String // LOW, MEDIUM, HIGH, CRITICAL
  decision       String // ALLOW, REVIEW, BLOCK
  reasons        String // JSON array
  confidence     Float
  riskFactors    String // JSON object
  status         String   @default("NEW") // NEW, REVIEWED, RESOLVED
  ipAddress      String?
  userAgent      String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  user User? @relation(fields: [userId], references: [id])

  @@map("fraud_alerts")
}

model Device {
  id           Int      @id @default(autoincrement())
  deviceId     String   @unique
  deviceName   String
  platform     String   @default("android")
  appVersion   String?
  osVersion    String?
  ipAddress    String?
  isOnline     Boolean  @default(false)
  lastSeen     DateTime @default(now())
  totalUsers   Int      @default(0)
  totalBalance Float    @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("devices")
}

model UserSession {
  id        Int      @id @default(autoincrement())
  userId    Int
  deviceId  String
  token     String   @unique
  expiresAt DateTime
  isActive  Boolean  @default(true)
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@map("user_sessions")
}

model AdminLog {
  id        Int      @id @default(autoincrement())
  action    String // LOGIN, BALANCE_UPDATE, USER_CREATE, etc
  details   String? // JSON details
  ipAddress String?
  userAgent String?
  success   Boolean  @default(true)
  createdAt DateTime @default(now())

  @@map("admin_logs")
}

model SystemSettings {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
  type  String @default("string") // string, number, boolean, json

  @@map("system_settings")
}
